### âœ‰ï¸ êµ¬ê¸€ SMTP ì„œë²„ë¥¼ ì´ìš©í•œ ë©”ì¼ ê¸°ëŠ¥ êµ¬í˜„

1. **êµ¬ê¸€ ê³„ì • - ì•± ë¹„ë°€ë²ˆí˜¸ ìƒì„±**
   - êµ¬ê¸€ ê³„ì •ì—ì„œ ì•± ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ì—¬ SMTP ì„œë²„ë¥¼ ì´ìš©í•´ ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

2. **pom.xmlì— ì´ë©”ì¼ ê´€ë ¨ ì˜ì¡´ì„± ì¶”ê°€**
   - ì´ë©”ì¼ ì „ì†¡ ê¸°ëŠ¥ì„ ìœ„í•´ `spring-context-support`ì™€ `javax.mail` ì˜ì¡´ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
   ```xml
   <!-- ì´ë©”ì¼ -->
   <dependency>
       <groupId>org.springframework</groupId>
       <artifactId>spring-context-support</artifactId>
       <version>${org.springframework-version}</version>
   </dependency>
   <dependency>
       <groupId>javax.mail</groupId>
       <artifactId>javax.mail-api</artifactId>
       <version>1.5.4</version>
   </dependency>
   <dependency>
       <groupId>com.sun.mail</groupId>
       <artifactId>javax.mail</artifactId>
       <version>1.5.3</version>
   </dependency>
   ```

3. **root-content.xmlì— mailSender bean ì¶”ê°€**
   - ë©”ì¼ ì „ì†¡ì„ ìœ„í•œ `mailSender` ë¹ˆì„ ì„¤ì •í•©ë‹ˆë‹¤. `username`ì— êµ¬ê¸€ ê³„ì • ì´ë©”ì¼, `password`ì— ìƒì„±í•œ ì•± ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.
   ```xml
   <bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
       <property name="host" value="smtp.gmail.com" />
       <property name="port" value="587" />
       <property name="username" value="í‚¤ ìƒì„±í•œ ì´ë©”ì¼" />
       <property name="password" value="ì•± í‚¤" />
       <property name="javaMailProperties">
           <props>
               <prop key="mail.transport.protocol">smtp</prop>
               <prop key="mail.smtp.auth">true</prop>
               <prop key="mail.smtp.starttls.enable">true</prop>
               <prop key="mail.smtp.socketFactory.class">javax.net.ssl.SSLSocketFactory</prop>
               <prop key="mail.debug">true</prop>
           </props>
       </property>
   </bean>
   ```

4. **MailService.java ìƒì„±**
   - ë©”ì¼ ì „ì†¡ ê¸°ëŠ¥ì„ êµ¬í˜„í•œ `MailService` í´ë˜ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ë¹„ë™ê¸°ë¡œ ë©”ì¼ì„ ì „ì†¡í•˜ê¸° ìœ„í•´ `@Async` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
   ```java
   package com.future.my.common.service;

   import java.io.UnsupportedEncodingException;

   import javax.mail.MessagingException;
   import javax.mail.internet.MimeMessage;

   import org.springframework.beans.factory.annotation.Autowired;
   import org.springframework.mail.javamail.JavaMailSender;
   import org.springframework.mail.javamail.MimeMessageHelper;
   import org.springframework.scheduling.annotation.Async;
   import org.springframework.stereotype.Service;

   @Service
   public class MailService {

       @Autowired
       private JavaMailSender mailSender;

       @Async // ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬
       public void sendMail(String to, String title, String content) {
           MimeMessage message = mailSender.createMimeMessage();
           MimeMessageHelper messageHelper;

           try {
               messageHelper = new MimeMessageHelper(message, true, "UTF-8");
               messageHelper.setFrom("thgmldl0115@gmail.com", "ê´€ë¦¬ì");
               messageHelper.setSubject(title);
               messageHelper.setTo(to);
               messageHelper.setText(content);
               mailSender.send(message);
           } catch (MessagingException | UnsupportedEncodingException e) {
               e.printStackTrace();
           }
       }
   }
   ```
   - **ì„¤ëª…**: ë³´ë‚´ëŠ” ì‚¬ëŒì€ ê³ ì •í•˜ê³ , ë©”ì¼ ë‚´ìš©ê³¼ ìˆ˜ì‹ ì ì£¼ì†Œë§Œ ë°›ì•„ì„œ ë©”ì¼ì„ ì „ì†¡í•©ë‹ˆë‹¤.

5. **MailController.java ìƒì„±**
   - ë©”ì¼ ì „ì†¡ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
   ```java
   package com.future.my.common.web;

   import org.springframework.beans.factory.annotation.Autowired;
   import org.springframework.scheduling.annotation.EnableAsync;
   import org.springframework.stereotype.Controller;
   import org.springframework.web.bind.annotation.RequestMapping;

   import com.future.my.common.service.MailService;

   @Controller
   @EnableAsync
   public class MailController {

       @Autowired
       private MailService mailService;

       @RequestMapping("/sendMailDo")
       public String sendMailDo() {
           mailService.sendMail("ë©”ì¼ ë³´ë‚¼ ì£¼ì†Œ", "test", "í…ŒìŠ¤íŠ¸ ë©”ì¼ì…ë‹ˆë‹¤.");
           return "home";
       }
   }
   ```
   - **ì„¤ëª…**: `/sendMailDo` ê²½ë¡œë¡œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ë©”ì¼ì„ ì „ì†¡í•©ë‹ˆë‹¤. ì´í›„ ì„œë²„ì—ì„œ í•´ë‹¹ ê²½ë¡œë¥¼ ì‹¤í–‰í•˜ì—¬ ë©”ì¼ ì „ì†¡ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

6. **ë©”ì¼ ì „ì†¡ ì˜¤ë¥˜ ìˆ˜ì •**
   - SMTP ì„¤ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì•„ë˜ ì„¤ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
   ```xml
   <prop key="mail.smtp.ssl.trust">smtp.gmail.com</prop>
   <!-- <prop key="mail.smtp.socketFactory.class">javax.net.ssl.SSLSocketFactory</prop> -->
   ```

7. **ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•œ íšŒì› ê³„ì • í™•ì¸**
   - íŠ¹ì • ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì•¼ í•˜ëŠ” ê²½ìš°ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
   ```java
   @RequestMapping("/admin")
   public String admin(HttpSession session) {
       MemberVO login = (MemberVO) session.getAttribute("login");
       if (login == null || !login.getMemId().equals("admin")) {
           return "home";
       } else {
           return "admin";
       }
   }
   ```

8. **MailVO ìƒì„± ë° ì»¨íŠ¸ë¡¤ëŸ¬ ìˆ˜ì •**
   - ì—¬ëŸ¬ ëª…ì—ê²Œ ë©”ì¼ì„ ë³´ë‚´ê¸° ìœ„í•´ `MailVO`ì— ì´ë©”ì¼ ë¦¬ìŠ¤íŠ¸(ArrayList)ë¥¼ ì¶”ê°€í•˜ê³ , `MailController`ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
   ```java
   private String title;
   private String content;
   private ArrayList<String> email;
   ```
   - **MailController ìˆ˜ì •**
   ```java
   @RequestMapping("/sendMailDo")
   public String sendMailDo(MailVO mailVO) {
       ArrayList<String> arr = mailVO.getEmail();
       for (String email : arr) {
           mailService.sendMail(email, mailVO.getTitle(), mailVO.getContent());
       }
       return "home";
   }
   ```

9. **admin.jsp ìˆ˜ì •**
   - ì—¬ëŸ¬ ëª…ì—ê²Œ ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.
   - **top.jsp ì¶”ê°€**
   ```jsp
   <jsp:include page="/WEB-INF/inc/top.jsp"></jsp:include>
   ```
   - **form action ì¶”ê°€**
   ```jsp
   <form method="post" action="<c:url value="/sendMailDo"/>">
   ```
   - **ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ (ì´ë©”ì¼ ì…ë ¥ í•„ë“œ ì¶”ê°€ ë²„íŠ¼ êµ¬í˜„)**
   ```javascript
   $(document).ready(function() {
       var cnt = 1;
       $("#addBtn").click(function() {
           var clone = $("#email0").clone(true);
           clone.attr("id", "email" + cnt);
           clone.find('input').attr("name", "email[" + cnt + "]").val('');
           clone.find('label').attr("for", "email" + cnt);
           $("#emailArr").append(clone);
           cnt++;
       });
   });
   ```
   - **ì„¤ëª…**: ì—¬ëŸ¬ ëª…ì—ê²Œ ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ” í¼ì„ êµ¬í˜„í•˜ì—¬, ì¶”ê°€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìˆ˜ì‹ ì ì´ë©”ì¼ í•„ë“œë¥¼ ê³„ì†í•´ì„œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ”— ì‚¬ìš©ì ê¸°ë°˜ ìœ ì‚¬ë„ ì¶”ì²œ ê¸°ëŠ¥ êµ¬í˜„

1. **MemberVOì— OptionVO, QuestionVO ì¶”ê°€**
   - ì‚¬ìš©ìì˜ ì„ í˜¸ë„ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ `OptionVO`ì™€ `QuestionVO`ë¥¼ `MemberVO`ì— ì¶”ê°€í•©ë‹ˆë‹¤.

2. **member.xml ìˆ˜ì •**
   - ì„¤ë¬¸ì¡°ì‚¬ ê²°ê³¼ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•œ `ResultMap`ê³¼ `SELECT` êµ¬ë¬¸ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
   ```xml
   <!-- ResultMap ì •ì˜ -->
   <resultMap id="QuestionMap" type="com.future.my.member.vo.QuestionVO">
       <id property="qId" column="q_id" />
       <result property="qContent" column="q_content" />
       <collection property="options" ofType="com.future.my.member.vo.OptionVO">
           <id property="oId" column="o_id" />
           <result property="oContent" column="o_content" />
       </collection>
   </resultMap>

   <select id="getSurvey" resultMap="QuestionMap">
       SELECT a.q_id,
              a.q_content,
              b.o_id,
              b.o_content
       FROM questions a, q_options b
       WHERE a.q_id = b.q_id
       ORDER BY a.q_id, b.o_id
   </select>
   ```

3. **IMemberDAO ì¶”ê°€**
   - ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
   ```java
   // ì§ˆë¬¸
   public ArrayList<QuestionVO> getSurvey();
   ```

4. **MemberService êµ¬í˜„**
   - ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„°ë¥¼ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
   ```java
   public ArrayList<QuestionVO> getSurvey() {
       return dao.getSurvey();
   }
   ```

5. **MemberControllerì— ì„¤ë¬¸ì¡°ì‚¬ ì²˜ë¦¬ ì¶”ê°€**
   - ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³ , ëª¨ë¸ì— ì¶”ê°€í•˜ì—¬ JSPë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
   ```java
   @RequestMapping("/survey")
   public String survey(Model model) {
       ArrayList<QuestionVO> qList = memberService.getSurvey();
       model.addAttribute("qList", qList);
       return "member/survey";
   }
   ```

6. **survey.jsp ìƒì„±**
   - ì„¤ë¬¸ì¡°ì‚¬ í˜ì´ì§€ë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©ìê°€ ì„ í˜¸í•˜ëŠ” ì—¬ê°€ í™œë™ì„ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
   ```jsp
   <%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
   <%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
   <!DOCTYPE html>
   <html>
   <head>
       <meta charset="UTF-8">
       <title>ì„¤ë¬¸</title>
   </head>
   <body>
       <jsp:include page="/WEB-INF/inc/top.jsp"></jsp:include>
       <section class="page-section" id="contact" style="margin-top: 150px">
           <div class="container mt-5">
               <h2>ê³ ê° ì·¨í–¥ ì •ë³´ ì…ë ¥</h2>
               <form id="preferenceForm">
                   <div class="form-group">
                       <label for="leisure">ì´ë¦„</label>
                       <input name="mem_nm" type="text">
                   </div>
                   <c:forEach items="${qList}" var="question">
                       <div class="form-group">
                           <label for="${question.qCategory}">${question.qContent}</label>
                           <select name="${question.qCategory}" id="${question.qCategory}">
                               <c:forEach items="${question.options}" var="option">
                                   <option value="${option.oId}">${option.oContent}</option>
                               </c:forEach>
                           </select>
                       </div>
                   </c:forEach>
                   <button type="submit" class="btn btn-primary">ìœ ì‚¬ ê³ ê° ì°¾ê¸°</button>
               </form>
               <h3 class="mt-5">ì¶”ì²œëœ ìœ ì‚¬ ê³ ê°:</h3>
               <ul id="similarCustomersList" class="list-group"></ul>
           </div>
       </section>
       
       <script>
           $(document).ready(function() {
               $("#preferenceForm").on("submit", function(e) {
                   e.preventDefault();
                   console.log($(this).serialize());
                   $.ajax({
                       type: "POST",
                       url: "http://192.168.0.12:5000/get_similar",
                       data: $(this).serialize(),
                       success: function(res) {
                           console.log(res);
                           $("#similarCustomersList").empty();
                           res.forEach(function(member) {
                               $("#similarCustomersList").append('<li>' + member.mem_nm + '</li>');
                           });
                       },
                       error: function(e) {
                           console.log(e);
                       }
                   });
               });
           });
       </script>

       <jsp:include page="/WEB-INF/inc/footer.jsp"></jsp:include>
   </body>
   </html>
   ```

