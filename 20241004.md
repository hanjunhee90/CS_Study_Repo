# π“ [tech7-μ¤ν”„λ§] μμ—… λ‚΄μ© μ •λ¦¬

## λ©μ°¨
1. [μμ—… κ°μ”](#μμ—…-κ°μ”)
2. [μ£Όμ” κ°λ…](#μ£Όμ”-κ°λ…)
3. [μ‹¤μµ λ° μμ ](#μ‹¤μµ-λ°-μμ )
4. [μ°Έκ³  μλ£](#μ°Έκ³ -μλ£)
5. [μ§λ¬Έ λ° λ‹µλ³€](#μ§λ¬Έ-λ°-λ‹µλ³€)

---

## μμ—… κ°μ”
**λ‚ μ§:** 2024λ…„ 10μ›” 04μΌ  
**κ°•μ‚¬:** [nick]  
**μ£Όμ :** [spring framework μ‹νλ¦¬ν‹°-λΉ„λ²]  

 -  spring security, 

---
<!-- ![spring](./img/spring.svg) -->

## μ£Όμ” κ°λ…

# μ•”νΈν™” κ°λ… μ •λ¦¬

### 1. μ•”νΈν™”λ€?
μ•”νΈν™”λ” λ°μ΄ν„°λ¥Ό λ³΄νΈν•κΈ° μ„ν•΄ ν‰λ¬Έ λ°μ΄ν„°λ¥Ό νΉμ • μ•κ³ λ¦¬μ¦μ„ ν†µν•΄ λ³€ν•ν•μ—¬, μΈκ°€λ μ‚¬μ©μλ§μ΄ ν•΄λ‹Ή λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν•  μ μλ„λ΅ λ§λ“λ” κΈ°μ μ…λ‹λ‹¤. μ•”νΈν™” λ°©μ‹μ€ ν¬κ² **λ‹¨λ°©ν–¥ μ•”νΈν™”**μ™€ **μ–‘λ°©ν–¥ μ•”νΈν™”**λ΅ λ‚λ μ μμµλ‹λ‹¤.

- **λ‹¨λ°©ν–¥ μ•”νΈν™”**: μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν•  μ μ—†λ” λ°©μ‹μΌλ΅, μ£Όλ΅ λΉ„λ°€λ²νΈ μ €μ¥ μ‹ μ‚¬μ©λ©λ‹λ‹¤. λ³µνΈν™”ν•  ν•„μ”κ°€ μ—†λ” λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² κ΄€λ¦¬ν•κΈ° μ„ν• μ©λ„λ΅ μ‚¬μ©λ©λ‹λ‹¤.
- **μ–‘λ°©ν–¥ μ•”νΈν™”**: μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ‹¤μ‹ λ³µνΈν™”ν•  μ μλ” λ°©μ‹μΌλ΅, μ¤‘μ”ν• λ°μ΄ν„° μ „μ†΅ μ‹ μ‚¬μ©λ©λ‹λ‹¤. λ°μ΄ν„° λ³µμ› κ°€λ¥μ„±μ΄ ν•„μ”ν• κ²½μ°μ— μ ν•©ν•©λ‹λ‹¤.

### 2. μ¤ν”„λ§ ν”„λ μ„μ›ν¬μ—μ„μ μ•”νΈν™”

μ¤ν”„λ§ ν”„λ μ„μ›ν¬μ—μ„ μ•”νΈν™”λ” μ£Όλ΅ **Spring Security**λ¥Ό ν†µν•΄ κµ¬ν„λ©λ‹λ‹¤. μ£Όλ΅ λΉ„λ°€λ²νΈ μ•”νΈν™”μ™€ μΈμ¦ κ΄€λ ¨ κΈ°λ¥μ— μ‚¬μ©λ©λ‹λ‹¤.

#### pom.xml μ„¤μ •
Spring Securityλ¥Ό μ‚¬μ©ν•κΈ° μ„ν•΄ ν•„μ”ν• μμ΅΄μ„±μ„ `pom.xml`μ— μ¶”κ°€ν•©λ‹λ‹¤:

```xml
<dependency>
  <groupId>org.springframework.security</groupId>
  <artifactId>spring-security-web</artifactId>
  <version>5.3.13.RELEASE</version>
</dependency>

<dependency>
  <groupId>org.springframework.security</groupId>
  <artifactId>spring-security-config</artifactId>
  <version>5.3.13.RELEASE</version>
</dependency>

<dependency>
  <groupId>org.springframework.security</groupId>
  <artifactId>spring-security-taglibs</artifactId>
  <version>5.3.13.RELEASE</version>
</dependency>
```

#### μ•”νΈν™” μ„¤μ •
μ•”νΈν™”λ¥Ό μ„ν• λΉ(bean)μ„ μ„¤μ •ν•©λ‹λ‹¤. μ—¬κΈ°μ„λ” **BCryptPasswordEncoder**λ¥Ό μ‚¬μ©ν•μ—¬ λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™”ν•©λ‹λ‹¤:

```xml
<bean id="passwordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"/>
```

μ΄ λΉμ„ ν†µν•΄ μ•”νΈν™”λ¥Ό μν–‰ν•λ©°, μ£Όλ΅ λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™”ν• ν›„ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•  λ• μ‚¬μ©λ©λ‹λ‹¤.

### 3. νμ›κ°€μ… μ‹ μ•”νΈν™” μ μ©
νμ›κ°€μ… μ‹ μ‚¬μ©μμ λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™”ν• ν›„ μ €μ¥ν•©λ‹λ‹¤. μ΄λ¥Ό μ„ν•΄, λ―Έλ¦¬ μ„¤μ •λ **BCryptPasswordEncoder**λ¥Ό μ‚¬μ©ν•μ—¬ λΉ„λ°€λ²νΈλ¥Ό μ•μ „ν•κ² μ•”νΈν™”ν•©λ‹λ‹¤.

```java
String rawPassword = "userPassword";
String encodedPassword = passwordEncoder.encode(rawPassword);
```

### 4. λ΅κ·ΈμΈ μ²λ¦¬ μ‹ μ•”νΈν™”λ λΉ„λ°€λ²νΈ κ²€μ¦
λ΅κ·ΈμΈ μ‹μ—λ” μ‚¬μ©μκ°€ μ…λ ¥ν• λΉ„λ°€λ²νΈμ™€ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥λ μ•”νΈν™”λ λΉ„λ°€λ²νΈλ¥Ό λΉ„κµν•©λ‹λ‹¤. μ΄λ•, **matches** λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”λ λΉ„λ°€λ²νΈμ™€ μΌμΉν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```java
boolean isPasswordMatch = passwordEncoder.matches(rawPassword, encodedPassword);
```

μ΄ λ©”μ„λ“λ” μ•”νΈν™”λ λΉ„λ°€λ²νΈμ—μ„ Salt κ°’μ„ μ¶”μ¶ν•μ—¬ λ™μΌν• λ°©μ‹μΌλ΅ μ•”νΈν™”ν• ν›„ λΉ„κµν•©λ‹λ‹¤. λ”°λΌμ„, λΉ„λ°€λ²νΈλ¥Ό μ¬μ•”νΈν™”ν•΄λ„ κ°’μ΄ λ‹¬λΌμ§€μ§€λ§, λΉ„κµλ” μ •ν™•ν•κ² μ΄λ£¨μ–΄μ§‘λ‹λ‹¤.

### 5. μ•”νΈν™”μ νΉμ§•
- **Salt μ‚¬μ©**: BCrypt μ•”νΈν™” λ°©μ‹μ—μ„λ” Saltλ¥Ό μ‚¬μ©ν•μ—¬ λ™μΌν• λΉ„λ°€λ²νΈλΌλ„ μ„λ΅ λ‹¤λ¥Έ μ•”νΈν™”λ κ°’μ„ μƒμ„±ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ λ¬΄μ‘μ„ λ€μ… κ³µκ²©(Brute Force Attack) λ“±μ„ λ°©μ§€ν•©λ‹λ‹¤.
- **λ‹¨λ°©ν–¥ μ•”νΈν™”**: BCryptλ” λ‹¨λ°©ν–¥ μ•”νΈν™”λ΅, λ³µνΈν™”κ°€ λ¶κ°€λ¥ν• μ•”νΈν™” λ°©μ‹μ…λ‹λ‹¤. λ”°λΌμ„, λΉ„λ°€λ²νΈλ” λ³µνΈν™”ν•μ§€ μ•κ³  μ…λ ¥λ κ°’κ³Ό λΉ„κµν•μ—¬ κ²€μ¦ν•©λ‹λ‹¤.

### 6. μ¤ν”„λ§ μ‹νλ¦¬ν‹° μ•”νΈν™” ν™μ©
μ¤ν”„λ§ μ‹νλ¦¬ν‹°λ” μ•”νΈν™” μ™Έμ—λ„ λ‹¤μ–‘ν• λ³΄μ• κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤. λ΅κ·ΈμΈ, κ¶ν• κ΄€λ¦¬, CSRF λ°©μ–΄ λ“± λ‹¤μ–‘ν• κΈ°λ¥κ³Ό κ²°ν•©ν•μ—¬ μ• ν”λ¦¬μΌ€μ΄μ… λ³΄μ•μ„ κ°•ν™”ν•  μ μμµλ‹λ‹¤.



λ‹¤μμ€ Springμ—μ„ `app.properties` νμΌμ κ°’μ„ λ¶λ¬μ¤λ” λ°©λ²•μ„ μ„¤λ…ν•λ” λ‚΄μ©μ…λ‹λ‹¤.


# Springμ—μ„ `app.properties` νμΌ κ°’μ„ λ¶λ¬μ¤λ” λ°©λ²•

Spring μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ™Έλ¶€ μ„¤μ • νμΌ(`app.properties`)μ κ°’μ„ λ¶λ¬μ™€ μ‚¬μ©ν•λ ¤λ©΄ λ‹¤μ λ‹¨κ³„λ¥Ό λ”°λ¥Ό μ μμµλ‹λ‹¤.

## 1. `app.properties` νμΌ μ„¤μ •
λ¨Όμ €, μ™Έλ¶€ μ„¤μ • νμΌμΈ `app.properties` νμΌμ— ν•„μ”ν• μ„¤μ • κ°’μ„ μ •μν•©λ‹λ‹¤.

μμ‹:
```
file.upload.path=/uploads/images
file.download.path=/downloads/images
```

## 2. `servlet-context.xml`μ—μ„ `util:properties` μ‚¬μ©
Spring XML μ„¤μ • νμΌ(`servlet-context.xml`)μ—μ„ `util:properties` νƒκ·Έλ¥Ό μ‚¬μ©ν•μ—¬ ν•΄λ‹Ή μ„¤μ • νμΌμ„ Spring μ»¨ν…μ¤νΈμ— λ΅λ“ν•©λ‹λ‹¤.

```xml
<util:properties id="util" location="classpath:/config/app.properties" />
```

μ΄ μ„¤μ •μ€ `app.properties` νμΌμ„ μ½κ³ , κ·Έ μ•μ κ°’μ„ Spring μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ‚¬μ©ν•  μ μλ„λ΅ ν•©λ‹λ‹¤.

## 3. Java ν΄λμ¤μ—μ„ `@Value`λ΅ μ„¤μ • κ°’ λ¶λ¬μ¤κΈ°
μ΄μ  Java ν΄λμ¤μ—μ„ `@Value` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ `app.properties` νμΌμ κ°’μ„ λ¶λ¬μ¬ μ μμµλ‹λ‹¤.

```java
import org.springframework.beans.factory.annotation.Value;

public class FileService {

    @Value("#{util['file.upload.path']}")
    private String CURR_IMAGE_PATH;

    @Value("#{util['file.download.path']}")
    private String WEB_PATH;

    // CURR_IMAGE_PATHμ™€ WEB_PATHλ¥Ό μ‚¬μ©ν•λ” λ©”μ„λ“λ“¤
}
```

μ„ μ½”λ“μ—μ„λ” `app.properties` νμΌμ— μ •μλ `file.upload.path`μ™€ `file.download.path` κ°’μ„ κ°κ° `CURR_IMAGE_PATH`μ™€ `WEB_PATH` λ³€μμ— μ €μ¥ν•©λ‹λ‹¤.

## μ”μ•½
1. `app.properties` νμΌμ— μ„¤μ • κ°’μ„ μ •μν•©λ‹λ‹¤.
2. `servlet-context.xml` νμΌμ—μ„ `util:properties` νƒκ·Έλ΅ μ„¤μ • νμΌμ„ λ΅λ“ν•©λ‹λ‹¤.
3. Java ν΄λμ¤μ—μ„ `@Value` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ—¬ μ„¤μ • κ°’μ„ λ¶λ¬μµλ‹λ‹¤.

μ΄λ ‡κ² ν•λ©΄ μ™Έλ¶€ μ„¤μ • νμΌμ„ ν†µν•΄ μ• ν”λ¦¬μΌ€μ΄μ…μ κ²½λ΅λ‚ κΈ°νƒ€ μ„¤μ • κ°’μ„ μ†μ‰½κ² κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.

---
# μ΄λ―Έμ§€ νμΌ μ—…λ΅λ“
**μ΄λ―Έμ§€ νμΌ μ—…λ΅λ“**λ¥Ό μ²λ¦¬ν•λ” Spring μ„λ²„μ™€ JavaScript ν΄λΌμ΄μ–ΈνΈ κ°„μ μƒνΈμ‘μ©μ„ μ„¤λ…ν•©λ‹λ‹¤. μ½”λ“λ” ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ μ΄λ―Έμ§€λ¥Ό μ„ νƒν•κ³ , μ„λ²„λ΅ μ „μ†΅ν•μ—¬ μ—…λ΅λ“λ μ΄λ―Έμ§€λ¥Ό μ²λ¦¬ν• ν›„, μ›Ή νμ΄μ§€μ— λ°”λ΅ λ°μν•λ” κ³Όμ •μ„ ν¬ν•¨ν•κ³  μμµλ‹λ‹¤.

## 1. ν•„μ λΌμ΄λΈλ¬λ¦¬ λ“±λ΅

μ΄ λ‘ κ°€μ§€ `dependency`λ” Apache Commons λΌμ΄λΈλ¬λ¦¬μ—μ„ νμΌ μ—…λ΅λ“ λ° μ…μ¶λ ¥(IO) μ‘μ—…μ„ μ²λ¦¬ν•κΈ° μ„ν• μμ΅΄μ„±μ…λ‹λ‹¤. κ° μμ΅΄μ„±μ μ—­ν• μ„ μ„¤λ…ν•κ² μµλ‹λ‹¤.

### 1. `commons-fileupload`

```xml
<dependency>
    <groupId>commons-fileupload</groupId>
    <artifactId>commons-fileupload</artifactId>
    <version>1.4</version>
</dependency>
```

- **μ—­ν• **: `commons-fileupload`λ” **νμΌ μ—…λ΅λ“**λ¥Ό μ§€μ›ν•λ” λΌμ΄λΈλ¬λ¦¬μ…λ‹λ‹¤. μ΄ λΌμ΄λΈλ¬λ¦¬λ¥Ό ν†µν•΄ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ „μ†΅λ νμΌμ„ μ²λ¦¬ν•  μ μμµλ‹λ‹¤.
- **μ£Όμ” κΈ°λ¥**:
  - HTTP μ”μ²­μΌλ΅ μ „μ†΅λ νμΌμ„ ν•΄μ„ν•κ³  νμΌ κ°μ²΄λ΅ λ³€ν™ν•λ” κΈ°λ¥.
  - λ‹¤μ¤‘ νμΌ μ—…λ΅λ“λ¥Ό μ§€μ›ν•λ©°, λ©”λ¨λ¦¬λ‚ λ””μ¤ν¬λ΅ νμΌμ„ μ €μ¥ν•λ” λ°©λ²•μ„ μ κ³µν•©λ‹λ‹¤.
  - Springμ—μ„ `MultipartFile`κ³Ό μ—°λ™λμ–΄ νμΌ μ—…λ΅λ“ μ²λ¦¬λ¥Ό μ‰½κ² ν•  μ μλ„λ΅ λ•μµλ‹λ‹¤.

### 2. `commons-io`

```xml
<dependency>
    <groupId>commons-io</groupId>
    <artifactId>commons-io</artifactId>
    <version>2.8.0</version>
</dependency>
```

- **μ—­ν• **: `commons-io`λ” **νμΌ λ° μ…μ¶λ ¥(IO) μ‘μ—…**μ„ λ³΄λ‹¤ νΈλ¦¬ν•κ² μ²λ¦¬ν•κΈ° μ„ν• μ ν‹Έλ¦¬ν‹° λΌμ΄λΈλ¬λ¦¬μ…λ‹λ‹¤.
- **μ£Όμ” κΈ°λ¥**:
  - νμΌ λ° λ””λ ‰ν† λ¦¬ κ΄€λ ¨ μ ν‹Έλ¦¬ν‹° λ©”μ„λ“ μ κ³µ (νμΌ λ³µμ‚¬, μ΄λ™, μ‚­μ , λ””λ ‰ν† λ¦¬ μƒμ„± λ“±).
  - μ¤νΈλ¦Ό(Stream) μ²λ¦¬λ¥Ό μ„ν• νΈλ¦¬ν• λ©”μ„λ“ (λ°μ΄ν„° μ½κΈ°/μ“°κΈ°, λ²„νΌ μ²λ¦¬ λ“±).
  - νμΌμ ν™•μ¥μ, MIME νƒ€μ…, νμΌ κ²½λ΅ λ“±μ„ λ‹¤λ£¨λ” κΈ°λ¥.
  - νμΌ μ‹μ¤ν…κ³Ό κ΄€λ ¨λ λ‹¤μ–‘ν• νΈμ λ©”μ„λ“λ¥Ό μ κ³µν•μ—¬ μ…μ¶λ ¥ μ‘μ—…μ„ ν¨μ¨μ μΌλ΅ μ²λ¦¬ν•  μ μλ„λ΅ λ„μ™€μ¤λ‹λ‹¤.

### μ”μ•½
- **`commons-fileupload`**: ν΄λΌμ΄μ–ΈνΈκ°€ μ—…λ΅λ“ν• νμΌμ„ μ„λ²„μ—μ„ μ²λ¦¬ν•λ” κΈ°λ¥μ„ μ κ³µ.
- **`commons-io`**: νμΌ μ…μ¶λ ¥ κ΄€λ ¨ μ‘μ—…μ„ μ‰½κ² ν•  μ μλ” μ ν‹Έλ¦¬ν‹° κΈ°λ¥μ„ μ κ³µ.

μ΄ λ‘ λΌμ΄λΈλ¬λ¦¬λ” νμΌ μ—…λ΅λ“ λ° μ²λ¦¬ μ‘μ—…μ„ ν•  λ• μ μ©ν•κ² μ‚¬μ©λ©λ‹λ‹¤.

## 2. μ„λ²„ μ½”λ“ (Spring Controller)

### 2.1 νμΌ μ—…λ΅λ“ μ²λ¦¬ λ©”μ„λ“ (`uploadFiles`)

```java
@ResponseBody
@PostMapping("/files/upload")
public Map<String, Object> uploadFiles(
    @RequestParam("uploadImage") MultipartFile uploadImage,
    HttpSession session) throws Exception {
    
    MemberVO login = (MemberVO) session.getAttribute("login");  // ν„μ¬ λ΅κ·ΈμΈλ μ‚¬μ©μ μ •λ³΄ κ°€μ Έμ¤κΈ°
    String imgPath = memberService.uploadProfile(login, CURR_IMATE_PATH, WEB_PATH, uploadImage);  // μ΄λ―Έμ§€ μ—…λ΅λ“ μ²λ¦¬
    Map<String, Object> map = new HashMap<>();  // κ²°κ³Όλ¥Ό λ‹΄μ„ λ§µ μƒμ„±
    map.put("message", "success");  // μ„±κ³µ λ©”μ‹μ§€ μ¶”κ°€
    map.put("imagePath", imgPath);  // μ΄λ―Έμ§€ κ²½λ΅ μ¶”κ°€
    return map;  // κ²°κ³Ό λ°ν™
}
```

- `@PostMapping("/files/upload")`: ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° `/files/upload` κ²½λ΅λ΅ POST μ”μ²­μ„ λ°›μµλ‹λ‹¤.
- `@RequestParam("uploadImage")`: μ”μ²­μΌλ΅λ¶€ν„° μ „μ†΅λ μ΄λ―Έμ§€ νμΌμ„ λ°›μ•„μµλ‹λ‹¤.
- `HttpSession session`: ν„μ¬ λ΅κ·ΈμΈν• μ‚¬μ©μ μ„Έμ…μ„ μ‚¬μ©ν•μ—¬ `MemberVO` κ°μ²΄μ—μ„ λ΅κ·ΈμΈ μ •λ³΄λ¥Ό κ°€μ Έμµλ‹λ‹¤.
- `memberService.uploadProfile`: μ„λΉ„μ¤ λ©”μ„λ“λ¥Ό νΈμ¶ν•μ—¬ μ΄λ―Έμ§€λ¥Ό μ—…λ΅λ“ν•©λ‹λ‹¤.
- μ—…λ΅λ“λ μ΄λ―Έμ§€ κ²½λ΅(`imgPath`)λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „λ‹¬ν•©λ‹λ‹¤.

### 2.2 νμΌ μ—…λ΅λ“ μ²λ¦¬ μ„λΉ„μ¤ (`uploadProfile`)

```java
public String uploadProfile(MemberVO member, String uploadDir, String webPath, MultipartFile file) throws Exception {
    String originFilename = file.getOriginalFilename();  // μ›λ³Έ νμΌ μ΄λ¦„ κ°€μ Έμ¤κΈ°
    String storedFilename = UUID.randomUUID().toString() + "_" + originFilename;  // μ λ‹ν¬ν• νμΌλ… μƒμ„±
    String dbFilePath = webPath + storedFilename;  // μ›Ήμ—μ„ μ‚¬μ©ν•  νμΌ κ²½λ΅
    Path filePath = Paths.get(uploadDir, storedFilename);  // μ„λ²„μ— μ €μ¥ν•  νμΌ κ²½λ΅ μ„¤μ •

    try {
        Files.copy(file.getInputStream(), filePath);  // μ„λ²„μ— νμΌ μ €μ¥
    } catch (IOException e) {
        throw new Exception("file to save the file", e);  // μ €μ¥ μ‹¤ν¨ μ‹ μμ™Έ μ²λ¦¬
    }

    member.setProfileImg(dbFilePath);  // λ©¤λ²„ κ°μ²΄μ— μ΄λ―Έμ§€ κ²½λ΅ μ„¤μ •
    int result = dao.profileUpload(member);  // DBμ— μ €μ¥

    if (result == 0) {
        throw new Exception();  // DBμ— μ €μ¥ μ‹¤ν¨ μ‹ μμ™Έ μ²λ¦¬
    }

    return dbFilePath;  // μ΄λ―Έμ§€ κ²½λ΅ λ°ν™
}
```

- `MultipartFile file`: μ—…λ΅λ“λ νμΌ κ°μ²΄λ¥Ό λ°›μ•„ μ²λ¦¬ν•©λ‹λ‹¤.
- `UUID.randomUUID()`: μ¤‘λ³µλ νμΌλ…μ„ λ°©μ§€ν•κΈ° μ„ν•΄ κ³ μ ν• νμΌλ…μ„ μƒμ„±ν•©λ‹λ‹¤.
- `Files.copy()`: νμΌμ„ μ„λ²„μ μ‹¤μ  κ²½λ΅(`uploadDir`)μ— μ €μ¥ν•©λ‹λ‹¤.
- `dbFilePath`: μ €μ¥λ νμΌμ κ²½λ΅λ¥Ό λ°ν™ν•κ³ , μ‚¬μ©μμ ν”„λ΅ν•„ μ΄λ―Έμ§€ κ²½λ΅λ¥Ό DBμ— μ—…λ°μ΄νΈν•©λ‹λ‹¤.

## 3. ν΄λΌμ΄μ–ΈνΈ μ½”λ“ (JavaScript + jQuery)

### 3.1 μ΄λ―Έμ§€ μ„ νƒ λ²„νΌ μ²λ¦¬

```javascript
$(document).ready(function(){
    $("#myImage").click(function(){
        $("#uploadImage").click();  // μ΄λ―Έμ§€λ¥Ό ν΄λ¦­ν•λ©΄ νμΌ μ„ νƒ μ°½μ΄ μ—΄λ¦½λ‹λ‹¤.
    });
});
```

- `#myImage`λ¥Ό ν΄λ¦­ν•λ©΄ `#uploadImage` νμΌ μ…λ ¥ ν•„λ“κ°€ ν΄λ¦­λμ–΄ νμΌ μ„ νƒ μ°½μ΄ μ—΄λ¦½λ‹λ‹¤.

### 3.2 μ΄λ―Έμ§€ νμΌ μ„ νƒ λ° μ ν¨μ„± κ²€μ‚¬

```javascript
$("#uploadImage").on("change", function(){
    let file = $(this)[0].files[0];  // μ„ νƒλ νμΌμ„ κ°€μ Έμ΄
    if(file){
        let fileType = file['type'];  // νμΌ νƒ€μ… ν™•μΈ
        let valTypes = ['image/gif','image/jpeg','image/png','image/jpg'];  // ν—μ©λ μ΄λ―Έμ§€ νμΌ νƒ€μ…
        if(!valTypes.includes(fileType)){
            alert("μ ν¨ν• μ΄λ―Έμ§€ νƒ€μ…μ΄ μ•„λ‹™λ‹λ‹¤.!!");  // μ ν¨ν•μ§€ μ•μ€ μ΄λ―Έμ§€ νƒ€μ…μ΄λ©΄ μ•λ¦Ό
            $(this).val('');  // μ„ νƒλ νμΌ μ΄κΈ°ν™”
        } else {
            let formData = new FormData($('#profileForm')[0]);  // FormData κ°μ²΄μ— νΌ λ°μ΄ν„°λ¥Ό λ‹΄μ
            $.ajax({
                url: '<c:url value="/files/upload" />',  // μ„λ²„μ— νμΌμ„ μ—…λ΅λ“ν•  κ²½λ΅
                type: 'POST',
                data: formData,  // FormData κ°μ²΄λ¥Ό μ „μ†΅
                dataType: 'json',
                processData: false,  // λ°μ΄ν„°λ¥Ό URL μΈμ½”λ”©ν•μ§€ μ•μ
                contentType: false,  // contentType μ„¤μ •ν•μ§€ μ•μ (κΈ°λ³Έκ°’ μ‚¬μ©)
                success: function(res){
                    console.log(res);  // μ„±κ³µ μ‹ μ‘λ‹µ μ¶λ ¥
                    $("#myImage").attr("src", "${pageContext.request.contextPath}" + res.imagePath);  // μ—…λ΅λ“λ μ΄λ―Έμ§€ κ²½λ΅λ΅ ν”„λ΅ν•„ μ΄λ―Έμ§€ μ—…λ°μ΄νΈ
                },
                error: function(e){
                    console.log(e);  // μ¤λ¥ λ°μƒ μ‹ μ½μ†”μ— μ¶λ ¥
                }
            });
        }
    }
});
```

- νμΌμ΄ μ„ νƒλλ©΄ `#uploadImage`μ `change` μ΄λ²¤νΈκ°€ λ°μƒν•©λ‹λ‹¤.
- μ΄λ―Έμ§€ νμΌμ μ ν¨μ„±μ„ κ²€μ‚¬ν• ν›„, μ ν¨ν• νμΌμ΄λ©΄ μ„λ²„μ— AJAX μ”μ²­μ„ ν†µν•΄ μ΄λ―Έμ§€λ¥Ό μ—…λ΅λ“ν•©λ‹λ‹¤.
- μ—…λ΅λ“κ°€ μ™„λ£λλ©΄ μ„λ²„κ°€ λ°ν™ν• κ²½λ΅(`res.imagePath`)λ¥Ό μ‚¬μ©ν•μ—¬ νμ΄μ§€μ—μ„ μ΄λ―Έμ§€λ¥Ό μ¦‰μ‹ μ—…λ°μ΄νΈν•©λ‹λ‹¤.

## 4. μ „μ²΄ νλ¦„ μ”μ•½
1. **ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ νμΌ μ„ νƒ**:
   - μ‚¬μ©μκ°€ μ΄λ―Έμ§€λ¥Ό ν΄λ¦­ν•λ©΄ νμΌ μ„ νƒ μ°½μ΄ μ—΄λ¦¬κ³ , νμΌμ„ μ„ νƒν•λ©΄ μ ν¨μ„±μ„ κ²€μ‚¬ν•©λ‹λ‹¤.
2. **μ„λ²„λ΅ νμΌ μ—…λ΅λ“**:
   - νμΌμ΄ μ ν¨ν•λ©΄ `FormData` κ°μ²΄λ¥Ό μ‚¬μ©ν•μ—¬ AJAX μ”μ²­μΌλ΅ μ„λ²„μ— νμΌμ„ μ „μ†΅ν•©λ‹λ‹¤.
3. **μ„λ²„μ—μ„ νμΌ μ €μ¥**:
   - μ„λ²„λ” ν•΄λ‹Ή νμΌμ„ νΉμ • κ²½λ΅μ— μ €μ¥ν•κ³ , νμΌ κ²½λ΅λ¥Ό DBμ— μ €μ¥ν• ν›„, ν΄λΌμ΄μ–ΈνΈλ΅ λ°ν™ν•©λ‹λ‹¤.
4. **μ΄λ―Έμ§€ κ²½λ΅ λ°μ**:
   - μ„λ²„μ—μ„ λ°ν™λ νμΌ κ²½λ΅λ¥Ό μ‚¬μ©ν•μ—¬ μ›Ή νμ΄μ§€μ— μ—…λ΅λ“λ μ΄λ―Έμ§€λ¥Ό λ°μν•©λ‹λ‹¤.

μ΄ μ½”λ“λ” μ‚¬μ©μκ°€ ν”„λ΅ν•„ μ΄λ―Έμ§€λ¥Ό μ‰½κ² μ—…λ΅λ“ν•κ³ , μ—…λ΅λ“λ μ΄λ―Έμ§€λ¥Ό μ›Ή νμ΄μ§€μ—μ„ μ¦‰μ‹ ν™•μΈν•  μ μλ„λ΅ ν•©λ‹λ‹¤.


```html
<form id="profileForm" enctype="multipart/form-data">
    <input type="file" name="uploadImage" id="uploadImage" accept="image/*" style="display:none;" >
</form>
```

### `multipart/form-data`μ μ—­ν• :
- **νμΌ μ „μ†΅**: HTML νΌμ΄ νμΌμ„ μ„λ²„λ΅ μ „μ†΅ν•  μ μκ² ν•λ” μΈμ½”λ”© λ°©μ‹μ…λ‹λ‹¤. κΈ°λ³Έ νΌ λ°μ΄ν„° μΈμ½”λ”© λ°©μ‹μ€ `application/x-www-form-urlencoded`λ΅, νμΌμ„ ν¬ν•¨ν•μ§€ μ•λ” κ°„λ‹¨ν• ν…μ¤νΈ λ°μ΄ν„°λ§ μ „μ†΅ν•  μ μμµλ‹λ‹¤. λ°λ©΄, `multipart/form-data`λ” ν…μ¤νΈ λ°μ΄ν„°μ™€ νμΌμ„ ν•¨κ» μ „μ†΅ν•  μ μμµλ‹λ‹¤.
- **νμΌ μ…λ ¥ ν•„λ“**: `<input type="file">`λ¥Ό μ‚¬μ©ν•μ—¬ νμΌμ„ μ„ νƒν•λ©΄, νμΌ λ°μ΄ν„°κ°€ μ΄ λ°©μ‹μΌλ΅ νΌμ— ν¬ν•¨λμ–΄ μ„λ²„λ΅ μ „μ†΅λ©λ‹λ‹¤.

### μ”μ•½:
- `enctype="multipart/form-data"`λ” νΌ λ°μ΄ν„°μ™€ ν•¨κ» νμΌμ„ μ„λ²„λ΅ μ „μ†΅ν•  λ• λ°λ“μ‹ ν•„μ”ν•©λ‹λ‹¤.
- `<input type="file">`μ€ νμΌμ„ μ„ νƒν•  μ μκ² ν•κ³ , μ„ νƒλ νμΌμ΄ μ „μ†΅λ  λ• `multipart/form-data`λ¥Ό ν†µν•΄ μ„λ²„λ΅ μ „μ†΅λ©λ‹λ‹¤.

μ΄ μΈμ½”λ”© λ°©μ‹ λ•λ¶„μ— μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ „μ†΅ν• νμΌμ„ μ½κ³  μ²λ¦¬ν•  μ μμµλ‹λ‹¤.



μ΄ μ½”λ“λ” **νμΌ λ‹¤μ΄λ΅λ“**λ¥Ό μ²λ¦¬ν•λ” Spring μ»¨νΈλ΅¤λ¬ λ©”μ„λ“μ…λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—μ„ νμΌμ„ λ‹¤μ΄λ΅λ“ν•  μ μλ„λ΅ νμΌμ„ μ½κ³  μ „μ†΅ν•λ” μ—­ν• μ„ ν•©λ‹λ‹¤. μ•„λλ” μ½”λ“μ κ° λ¶€λ¶„μ„ μ„¤λ…ν• λ‚΄μ©μ…λ‹λ‹¤.

### 1. λ©”μ„λ“ μ„¤λ…

```java
@RequestMapping("/download")
public void download(String imageFileName, HttpServletResponse response) throws IOException {
```
- **`@RequestMapping("/download")`**: μ΄ λ©”μ„λ“λ” `/download` κ²½λ΅λ΅ λ“¤μ–΄μ¤λ” HTTP μ”μ²­μ„ μ²λ¦¬ν•©λ‹λ‹¤.
- **`String imageFileName`**: λ‹¤μ΄λ΅λ“ν•  νμΌμ μ΄λ¦„μ„ μ”μ²­ νλΌλ―Έν„°λ΅ λ°›μµλ‹λ‹¤.
- **`HttpServletResponse response`**: HTTP μ‘λ‹µ κ°μ²΄λ΅, ν΄λΌμ΄μ–ΈνΈμ—κ² νμΌ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤.

### 2. νμΌ κ²½λ΅ μ„¤μ • λ° νμΌ κ°μ²΄ μƒμ„±

```java
OutputStream out = response.getOutputStream();
String downFile = CURR_IMATE_PATH + "\\" + imageFileName;
File file = new File(downFile);
```
- **`OutputStream out = response.getOutputStream()`**: ν΄λΌμ΄μ–ΈνΈμ—κ² λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ„ν• μ¶λ ¥ μ¤νΈλ¦Όμ„ μƒμ„±ν•©λ‹λ‹¤.
- **`CURR_IMATE_PATH + "\\" + imageFileName`**: νμΌμ„ μ €μ¥ν• κ²½λ΅μ™€ νμΌ μ΄λ¦„μ„ κ²°ν•©ν•΄ μ‹¤μ  νμΌμ κ²½λ΅(`downFile`)λ¥Ό λ§λ“­λ‹λ‹¤.
- **`File file = new File(downFile)`**: ν•΄λ‹Ή κ²½λ΅μ νμΌμ„ λ‚νƒ€λ‚΄λ” `File` κ°μ²΄λ¥Ό μƒμ„±ν•©λ‹λ‹¤.

### 3. νμΌμ΄ μ΅΄μ¬ν•λ”μ§€ ν™•μΈ

```java
if (!file.exists()) {
    response.sendError(HttpServletResponse.SC_NOT_FOUND, "file not found");
}
```
- **νμΌ μ΅΄μ¬ μ—¬λ¶€ ν™•μΈ**: `file.exists()`λ΅ νμΌμ΄ μ„λ²„μ— μ΅΄μ¬ν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
- **404 μ¤λ¥ λ°ν™**: νμΌμ΄ μ΅΄μ¬ν•μ§€ μ•μΌλ©΄ `response.sendError()`λ¥Ό ν†µν•΄ HTTP 404 μ‘λ‹µμ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅ν•κ³ , "file not found"λΌλ” λ©”μ‹μ§€λ¥Ό λ°ν™ν•©λ‹λ‹¤.

### 4. HTTP ν—¤λ” μ„¤μ •

```java
response.setHeader("Cache-Control", "no-cache");
response.setHeader("Content-Disposition", "attachment; fileName=" + imageFileName);
```
- **`Cache-Control: no-cache`**: ν΄λΌμ΄μ–ΈνΈκ°€ νμΌμ„ μΊμ‹ν•μ§€ μ•λ„λ΅ μ„¤μ •ν•©λ‹λ‹¤.
- **`Content-Disposition: attachment`**: μ΄ ν—¤λ”λ” νμΌμ„ λ‹¤μ΄λ΅λ“λ΅ μ²λ¦¬ν•κ² λ§λ“­λ‹λ‹¤. `fileName=`μ„ ν†µν•΄ νμΌ μ΄λ¦„μ„ μ§€μ •ν•μ—¬ ν΄λΌμ΄μ–ΈνΈκ°€ λ‹¤μ΄λ΅λ“ μ‹ ν•΄λ‹Ή μ΄λ¦„μΌλ΅ μ €μ¥λκ² ν•©λ‹λ‹¤.

### 5. νμΌ λ°μ΄ν„° μ „μ†΅

```java
try (FileInputStream in = new FileInputStream(file)) {
    byte[] buffer = new byte[1024 * 8];  // 8KB λ²„νΌ μƒμ„±
    while (true) {
        int count = in.read(buffer);  // νμΌ λ°μ΄ν„°λ¥Ό λ²„νΌμ— μ½μ–΄λ“¤μ„
        if (count == -1) {  // λ” μ΄μƒ μ½μ„ λ°μ΄ν„°κ°€ μ—†μΌλ©΄ λ£¨ν”„ μΆ…λ£
            break;
        }
        out.write(buffer, 0, count);  // μ½μ–΄λ“¤μΈ λ°μ΄ν„°λ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ μ „μ†΅
    }
} catch (IOException ex) {
    // μμ™Έ μ²λ¦¬ (νμΌ μ „μ†΅ μ¤‘ μ¤λ¥ λ°μƒ μ‹)
} finally {
    out.close();  // OutputStream λ‹«κΈ°
}
```
- **`FileInputStream`**: νμΌμ„ μ½κΈ° μ„ν• μ¤νΈλ¦Όμ„ μƒμ„±ν•©λ‹λ‹¤.
- **`byte[] buffer = new byte[1024 * 8]`**: 8KB ν¬κΈ°μ λ²„νΌλ¥Ό μƒμ„±ν•μ—¬ νμΌ λ°μ΄ν„°λ¥Ό μ½μ–΄λ“¤μΌ μ¤€λΉ„λ¥Ό ν•©λ‹λ‹¤.
- **νμΌ μ½κΈ° λ° μ „μ†΅**: `in.read(buffer)`λ΅ νμΌμ—μ„ λ°μ΄ν„°λ¥Ό μ½μ–΄ λ²„νΌμ— μ €μ¥ν•κ³ , `out.write()`λ΅ ν΄λΌμ΄μ–ΈνΈμ—κ² λ°μ΄ν„°λ¥Ό μ‹¤μ‹κ°„μΌλ΅ μ „μ†΅ν•©λ‹λ‹¤.
- **λ£¨ν”„ μΆ…λ£**: λ” μ΄μƒ μ½μ„ λ°μ΄ν„°κ°€ μ—†μΌλ©΄ (`count == -1`), λ£¨ν”„κ°€ μΆ…λ£λ©λ‹λ‹¤.
- **μ¤νΈλ¦Ό μΆ…λ£**: μ‘μ—…μ΄ λλ‚λ©΄ `out.close()`λ΅ μ¶λ ¥ μ¤νΈλ¦Όμ„ λ‹«μµλ‹λ‹¤.

### 6. μμ™Έ μ²λ¦¬

```java
catch (IOException ex) {
    // μμ™Έ μ²λ¦¬: νμΌ μ „μ†΅ μ¤‘ μ¤λ¥ λ°μƒ μ‹ μ²λ¦¬ν•  μ½”λ“
}
```
- νμΌ μ „μ†΅ μ¤‘ `IOException`μ΄ λ°μƒν•  μ μμµλ‹λ‹¤. μμ™Έκ°€ λ°μƒν• κ²½μ°, μ—¬κΈ°μ„ ν•„μ”ν• μ²λ¦¬λ¥Ό ν•  μ μμµλ‹λ‹¤.

### μ”μ•½
1. ν΄λΌμ΄μ–ΈνΈκ°€ `/download` κ²½λ΅λ΅ νμΌ μ΄λ¦„μ„ μ”μ²­ν•λ©΄, μ„λ²„λ” ν•΄λ‹Ή νμΌμ„ `CURR_IMATE_PATH` κ²½λ΅μ—μ„ μ°Ύμ•„ νμΌμ΄ μ΅΄μ¬ν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
2. νμΌμ΄ μ΅΄μ¬ν•λ©΄, νμΌμ„ μ½μ–΄λ“¤μ—¬ HTTP μ‘λ‹µμΌλ΅ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅ν•©λ‹λ‹¤.
3. ν΄λΌμ΄μ–ΈνΈλ” νμΌμ„ λ‹¤μ΄λ΅λ“ν•λ©°, μ„λ²„λ” νμΌμ„ μ½κ³  μ‹¤μ‹κ°„μΌλ΅ ν΄λΌμ΄μ–ΈνΈμ— νμΌ λ°μ΄ν„°λ¥Ό λ³΄λƒ…λ‹λ‹¤.
4. νμΌμ΄ μ΅΄μ¬ν•μ§€ μ•μΌλ©΄, 404 μ—λ¬λ¥Ό λ°ν™ν•©λ‹λ‹¤.

μ΄ λ©”μ„λ“λ” νμΌ λ‹¤μ΄λ΅λ“λ¥Ό μ„ν•΄ μ„λ²„μ νμΌμ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ¤νΈλ¦¬λ° λ°©μ‹μΌλ΅ μ „μ†΅ν•λ” μ „ν•μ μΈ λ°©μ‹μ…λ‹λ‹¤.

## μ°Έκ³  μλ£

- security κ΄€λ ¨

```xml
<dependency>
  <groupId>org.springframework.security</groupId>
  <artifactId>spring-security-web</artifactId>
  <version>5.3.13.RELEASE</version>
</dependency>

<dependency>
  <groupId>org.springframework.security</groupId>
  <artifactId>spring-security-config</artifactId>
  <version>5.3.13.RELEASE</version>
</dependency>

<dependency>
  <groupId>org.springframework.security</groupId>
  <artifactId>spring-security-taglibs</artifactId>
  <version>5.3.13.RELEASE</version>
</dependency>
```

- fileμ—…λ΅λ“ κ΄€λ ¨

```xml
        <dependency>
            <groupId>commons-fileupload</groupId>
            <artifactId>commons-fileupload</artifactId>
            <version>1.4</version>
        </dependency>
        <dependency>
            <groupId>commons-io</groupId>
            <artifactId>commons-io</artifactId>
            <version>2.8.0</version>
        </dependency>

```

## μ§λ¬Έ 




